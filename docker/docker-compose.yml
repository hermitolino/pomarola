version: '3.3'

services:
    node:
        build:
            context: ./node
            args: 
                - NODE_VERSION=latest
                - PROJECT_PATH=/opt/api/
                - NODE_ENV=production
                - YARN=true
        volumes:
            - ../api/:/opt/api
        entrypoint: run-node "node server.js"
        tty: true
    mongo:
        build: ./mongo
        expose:
            - "27017"
        volumes:
            - ./data/mongo:/var/lib/mongodb
    nginx:
        build:
            context: ./nginx
            args:
                - WEB_REVERSE_PROXY_PORT=8000
                - WEB_SSL=false
                - SELF_SIGNED=false
                - NO_DEFAULT=false
        volumes:
            - ./data/logs/nginx:/var/log/nginx
        ports:
            - "80:80"
            - "443:443"
        tty: true
